# Canvas Thumbnail Management System

This document provides a deep dive into how the Calligraphy app generates, stores, and displays thumbnails for the canvas list.

---

## üé® Overview

The thumbnail system ensures that every canvas board has a visual preview in the gallery. To maintain high performance and low storage footprint, we use a **vector-based SVG approach** rather than raster images (PNG/JPG).

## üîÑ The Full Process

### 1. Generation (SVG Engine)
Thumbnails are generated by the `ThumbnailService`. This service:
- Loads the canvas data (shapes).
- Calculates the bounding box of all shapes to ensure the "drawing" is centered and scaled to fit the `320x240` preview area.
- Converts each shape type (Rectangle, Circle, Triangle, Path) into its corresponding SVG element string.
- Wraps these elements in a standard `<svg>` tag with a dark background (`#2a2a2a`).

### 2. Implementation Logic
The core logic resides in `src/features/canvasManager/services/ThumbnailService.ts`:

```typescript
static async generateThumbnail(canvasId: string): Promise<string | null> {
  const canvasData = StorageService.loadCanvas(canvasId);
  // ... check if shapes exist ...
  const svg = this.generateSVG(canvasData.shapes);
  return svg; // Returns raw SVG string
}
```

### 3. Automatic Synchronization
Thumbnails are kept in sync with the canvas content using an **Auto-Save Hook** (`useAutoSave.ts`).
- When a user stops drawing (1-second debounce), the app saves the shapes.
- Immediately after saving the shapes, it calls `ThumbnailService.generateAndSave(canvasId)`.
- This ensures the gallery view always reflects the latest changes without manual intervention.

### 4. Persistence Layer
Thumbnails are stored in **MMKV**, a high-performance key-value store.
- Unlike the full canvas data (which contains all coordinates and history), the thumbnail is a single string.
- This allows the gallery list to load metadata and previews instantly without reading heavy JSON files for every board.

### 5. Efficient Rendering
In the gallery list (`CanvasThumbnail.tsx`), we use `react-native-svg` to render the stored SVG string:

```tsx
<SvgXml xml={validThumbnail} width="100%" height="100%" />
```

---

## üöÄ Performance Benefits

- **Low Memory Usage**: SVG strings are significantly smaller than Base64-encoded PNGs.
- **Infinite Scalability**: Since it's vector-based, the preview remains sharp at any size.
- **Lazy Loading**: The app only loads thumbnails for the visible items in the `FlatList`.

## üõ†Ô∏è Key Files
- `src/features/canvasManager/services/ThumbnailService.ts`: The generation engine.
- `src/features/canvas/hooks/useAutoSave.ts`: The trigger for generation.
- `src/features/canvasManager/components/CanvasThumbnail.tsx`: The UI display component.
- `src/core/storage/StorageService.ts`: The bridge to MMKV storage.
